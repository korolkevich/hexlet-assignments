# Javalin

## Ссылки

* [Группировка маршрутов при помощи методов routes() и path()](https://javalin.io/documentation#handler-groups)
* [Создание динамических маршрутов, имеющих внутри себя изменяемы части](https://javalin.io/documentation#endpoint-handlers)
* [Методы для работы с контекстом в Javalin](https://javalin.io/documentation#context)
* [Обновление данных в базе при помощи ORM](https://ebean.io/docs/query/update)
* [Удаление данных из базы при помощи ORM](https://ebean.io/docs/query/delete)

## src/main/java/exercise/App.java

## Задачи

* В методе `addRoutes()` добавьте в приложение маршруты для полного CRUD статьи:

  * *GET /articles* — список всех статей
  * *GET /articles/{id}* — просмотр конкретной статьи
  * *GET /articles/new* — вывод формы создания новой статьи
  * *POST /articles* — создание новой статьи
  * *GET /articles/{id}/edit* — вывод формы редактирования статьи
  * *POST /articles/{id}/edit* — обновление данных статьи
  * *GET /articles/{id}/delete* — вывод страницы с подтверждением удаления статьи
  * *POST /articles/{id}/delete* — удаление статьи

  Обратите внимание, что маршруты можно сгруппировать по пути. Воспользуйтесь для этого методами `routes()` и `path()`. Класс контроллер `ArticleController`, который будет обрабатывать запросы и обработчики уже созданы в файле *controllers/ArticleController.java*.

* Изучите код в методе `getTemplateEngine`. Посмотрите, как происходит подключение и настройка шаблонизатора Thymeleaf.

## src/main/java/exercise/controllers/ArticleController.java

## Задачи

* Допишите обработчик `editArticle`, который выводит форму редактирования статьи. Статья тоже должна допускать редактирование названия, содержания и категории. На странице редактирования должны отображаться данные статьи, поэтому понадобится получить из базы данные статьи, а также список всех категорий и передать их в шаблон. Для статьи атрибут назовите "article", а для списка статей — "categories". Шаблон для обработчика уже создан и находится по пути *articles/edit.html*

* Допишите обработчик `updateArticle`, который обновляет данные статьи в базе. После обновления статьи создайте flash-сообщение об успешном редактировании статьи и выполните редирект на страницу просмотра всех статей. Для создания flash-сообщения потребуется установить в сессию атрибут "flash" с текстом сообщения.

```java
ctx.sessionAttribute("flash", "Статья успешно создана");
```

* Допишите обработчик `deleteArticle`, который выводит страницу с подтверждением удаления статьи. Текст подтверждения должен содержать название статьи, поэтому потребуется получить статью из базы и передать ее в шаблон. Чтобы вывод в шаблоне был корректный, назовите атрибут "article". Шаблон для этого обработчика также создан и расположен по пути *articles/delete.html*

* Допишите обработчик `destroyArticle`, который удаляет данные статьи из базы. После  удаления статьи создайте flash-сообщение об успешном удалении статьи и выполните редирект на страницу просмотра всех статей.

## Подсказки

* Изучите методы для работы с контекстом

* Для получения динамической части маршрута используйте метод `pathParamAsClass()`. Так можно получить данные сразу в нужном формате

  ``` java
  long id = ctx.pathParamAsClass("id", Long.class).getOrDefault(null);
  ```

* Для получения данных формы используйте метод `formParam()`

* Чтобы установить атрибут в запрос и таким образом передать данные в шаблон, используйте метод `attribute()`

* Для редиректа используйте метод `redirect()`

* Для рендеринга шаблона используйте метод `render()`, передав туда путь к шаблону

* Чтобы обновить категорию статью, вам понадобится передать в метод `set()` id новой категории
